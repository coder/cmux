import { describe, it, expect } from "bun:test";
import { executeFileEditOperation } from "./file_edit_operation";
<<<<<<< HEAD
import { WRITE_DENIED_PREFIX } from "@/types/tools";
import { LocalRuntime } from "@/runtime/LocalRuntime";
||||||| parent of a522bfce (ðŸ¤– Integrate runtime config with workspace metadata and AIService)
import { WRITE_DENIED_PREFIX } from "./fileCommon";
import { LocalRuntime } from "@/runtime/LocalRuntime";
=======
import { WRITE_DENIED_PREFIX } from "./fileCommon";
import { createRuntime } from "@/runtime/runtimeFactory";
>>>>>>> a522bfce (ðŸ¤– Integrate runtime config with workspace metadata and AIService)

const TEST_CWD = "/tmp";

function createConfig() {
  return { cwd: TEST_CWD, runtime: createRuntime({ type: "local" }), tempDir: "/tmp" };
}

describe("executeFileEditOperation", () => {
  it("should return error when path validation fails", async () => {
    const result = await executeFileEditOperation({
      config: createConfig(),
      filePath: "../../etc/passwd",
      operation: () => ({ success: true, newContent: "", metadata: {} }),
    });

    expect(result.success).toBe(false);
    if (!result.success) {
      expect(result.error.startsWith(WRITE_DENIED_PREFIX)).toBe(true);
    }
  });
});

{"version":3,"file":"cacheStrategy.js","sourceRoot":"","sources":["../../../src/utils/ai/cacheStrategy.ts"],"names":[],"mappings":";;AAMA,8CA+BC;AAnCD;;;GAGG;AACH,SAAgB,iBAAiB,CAAC,QAAwB,EAAE,WAAmB;IAC7E,gDAAgD;IAChD,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,YAAY,CAAC,EAAE,CAAC;QAC1C,OAAO,QAAQ,CAAC;IAClB,CAAC;IAED,qDAAqD;IACrD,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QACxB,OAAO,QAAQ,CAAC;IAClB,CAAC;IAED,qDAAqD;IACrD,4EAA4E;IAC5E,MAAM,UAAU,GAAG,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC;IAEvC,OAAO,QAAQ,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE;QACjC,IAAI,KAAK,KAAK,UAAU,EAAE,CAAC;YACzB,OAAO;gBACL,GAAG,GAAG;gBACN,eAAe,EAAE;oBACf,SAAS,EAAE;wBACT,YAAY,EAAE;4BACZ,IAAI,EAAE,WAAoB;4BAC1B,GAAG,EAAE,IAAI;yBACV;qBACF;iBACF;aACF,CAAC;QACJ,CAAC;QACD,OAAO,GAAG,CAAC;IACb,CAAC,CAAC,CAAC;AACL,CAAC","sourcesContent":["import type { ModelMessage } from \"ai\";\n\n/**\n * Apply cache control to messages for Anthropic models\n * MVP: Single cache breakpoint before the last message\n */\nexport function applyCacheControl(messages: ModelMessage[], modelString: string): ModelMessage[] {\n  // Only apply cache control for Anthropic models\n  if (!modelString.startsWith(\"anthropic:\")) {\n    return messages;\n  }\n\n  // Need at least 2 messages to add a cache breakpoint\n  if (messages.length < 2) {\n    return messages;\n  }\n\n  // Add cache breakpoint at the second-to-last message\n  // This caches everything up to (but not including) the current user message\n  const cacheIndex = messages.length - 2;\n\n  return messages.map((msg, index) => {\n    if (index === cacheIndex) {\n      return {\n        ...msg,\n        providerOptions: {\n          anthropic: {\n            cacheControl: {\n              type: \"ephemeral\" as const,\n              ttl: \"5m\",\n            },\n          },\n        },\n      };\n    }\n    return msg;\n  });\n}\n"]}